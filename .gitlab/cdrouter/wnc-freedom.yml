.wnc-freedom: &wnc_freedom
  needs: ["build test qca_ipq95xx prpl cellular security thread"]
  extends:
    - .wnc-freedom testbed
    - .cdrouter

CDRouter-Top-100+mDNS Freedom initramfs:
  <<: *wnc_freedom
  variables:
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-dyndns.sh

CDRouter-Top-100+mDNS Freedom VLAN WAN/LAN initramfs:
  <<: *wnc_freedom
  variables:
    CDROUTER_TEST_CONFIG: vlan
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-dyndns.sh
      .gitlab/scripts/dut-init/cdrouter-dut-enable-vlans.sh

CDRouter-Top-100+mDNS Freedom PPPoE WAN initramfs:
  <<: *wnc_freedom
  variables:
    CDROUTER_TEST_CONFIG: ppp
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-dyndns.sh
      .gitlab/scripts/dut-init/cdrouter-dut-enable-pppoe.sh

CDRouter-Wireless Freedom initramfs:
  <<: *wnc_freedom
  stage: smoke tests
  timeout: 15 minutes
  variables:
    CDROUTER_TEST_CONFIG: wireless
    CDROUTER_CONFIG_WIFI_BEACON_PHY: 'ax b be g n'
    CDROUTER_CONFIG_WIFI_BEACON_RSN_CIPHER: 'CCMP-128 GCMP-256'
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-wireless.sh


.wnc-freedom-ipv6: &wnc_freedom_ipv6
  <<: *wnc_freedom
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - if: '$CI_COMMIT_BRANCH == $CI_DESIGNATED_BRANCH'
    - when: manual

CDRouter-UPnP-IPv46 Freedom initramfs:
  <<: *wnc_freedom_ipv6
  timeout: 60 minutes
  variables:
    CDROUTER_TEST_CONFIG: generic-ipv6-upnp
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh

CDRouter-UPnP-IPv46-Failing Freedom initramfs:
  <<: *wnc_freedom_ipv6
  timeout: 120 minutes
  allow_failure: true
  variables:
    CDROUTER_TEST_CONFIG: generic-ipv6-upnp
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh

CDRouter-IPv6-Top-100+mDNS Freedom initramfs:
  <<: *wnc_freedom_ipv6
  variables:
    CDROUTER_TEST_CONFIG: generic-ipv6
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh

prpl-Certification Freedom initramfs:
  <<: *wnc_freedom_ipv6
  timeout: 120 minutes
  allow_failure: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - when: manual
  variables:
    CDROUTER_TEST_CONFIG: generic-ipv6
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-cwmpd.sh

CDRouter-IPv6-Top-100+mDNS Freedom VLAN WAN/LAN initramfs:
  <<: *wnc_freedom_ipv6
  variables:
    CDROUTER_TEST_CONFIG: vlan-ipv6
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-enable-vlans.sh

.CDRouter-IPv6-Top-100+mDNS Freedom PPPoE WAN initramfs:
  <<: *wnc_freedom_ipv6
  variables:
    CDROUTER_TEST_CONFIG: ppp-ipv6
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-enable-pppoe.sh

CDRouter-TR-069 Freedom eMMC:
  <<: *wnc_freedom
  variables:
    LABGRID_TARGET: wnc-freedom-emmc
    TFTP_IMAGE_FILENAME: prplos-ipq95xx-generic-prpl_freedom-squashfs-sysupgrade.bin
    TFTP_IMAGE_FILENAME_PATTERN: /.*prplos-ipq95xx-generic-prpl_freedom-squashfs-sysupgrade.bin/
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-tr181-mockups.sh

CDRouter-USP-prpl Freedom initramfs:
  <<: *wnc_freedom
  allow_failure: true
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - when: manual
  variables:
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-dyndns.sh

prplWare-Smoke-Test-Suite Freedom initramfs:
  <<: *wnc_freedom_ipv6
  stage: smoke tests
  variables:
    CDROUTER_TEST_CONFIG: smoke-test
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-tr181-mockups.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-dyndns.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-prplmesh-controller.sh

.wnc-freedom-certification: &wnc_freedom_certification
  <<: *wnc_freedom_ipv6
  stage: certification tests
  timeout: 1h 45m
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - when: manual
  variables:
    CDROUTER_TEST_CONFIG: prplos-certification
    DUT_INIT_SCRIPTS: |
      .gitlab/scripts/dut-init/cdrouter-dut-flush-dns-relay-cache.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-cwmpd.sh
      .gitlab/scripts/dut-init/cdrouter-dut-configure-prplos-certification.sh

prplOS-Network-Test-Plan-Mandatory-v1.2.0 Freedom initramfs:
  <<: *wnc_freedom_certification

prplOS-Network-Test-Plan-Candidate-v1.2.0 Freedom initramfs:
  <<: *wnc_freedom_certification
  timeout: 52 minutes
